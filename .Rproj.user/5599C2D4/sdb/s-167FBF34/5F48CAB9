{
    "collab_server" : "",
    "contents" : "#==============================================================================\n#                         ANALISYS FOR THE BLOG\n#==============================================================================\n\noptions(stringsAsFactors = F)\nlibrary(magrittr)\nlibrary(plyr)\nlibrary(ggplot2)\nlibrary(stringr)\nlibrary(reshape2)\n\ntheme_set(theme_minimal())\n\n#1.- Load the data ------------------------------------------------------------\nDATA <- read.csv('Possesion_post/Dataset.csv')\n\n#2.- CLean the data for the analysis ------------------------------------------\n\n#Remove the percentage symbol\nDATA$value %<>% str_replace(pattern = '%',replacement = '') %>% \n  as.numeric\n\n#Recode for better visulization\nDATA$variable[DATA$variable=='Home'] <- 'H'\nDATA$variable[DATA$variable=='Away'] <- 'A'\n\n#Arrange the data in a nice format\nDATA %<>% dcast( formula = id~ Var + variable  , value.var = 'value') \n\n#3.- Descriptive analysis -----------------------------------------------------\n\n#Number of matches\nnrow(DATA)\n\n# Descriptive analysis of possesion\n\nsummary(DATA$Posession_H)\nsd(DATA$Posession_H)\n\n\nggplot(data=DATA, aes(x= Posession_H)) +\n  geom_histogram(aes (y=..count../sum(..count..)), fill='white',\n                 colour= \"#E69F00\", bins = 14, size = 1) +\n  labs(y ='Proportion', x = 'Posession (%) \\n HOME TEAM')\n\n#4.- Relationship with the goals scored----------------------------------------\n\nDATA$Result <- DATA$Goals_H - DATA$Goals_A\n\nCorrelation <- cor(DATA[,-c(1,4)]) %>% round(3) %>% melt\n\nggplot(data =Correlation, aes(x =Var1, y = Var2, fill=value)) + \n  geom_tile()+\n    scale_fill_gradient2(low = \"black\", high = \"black\", mid = \"white\") +\n  labs(x='', y='') +\n  theme(legend.title = element_text(colour = 'white'))\n\ncor_Pos <- cor(DATA[,-c(1,4)])[,'Posession_H'] %>% round(3) %>% data.frame\ncolnames(cor_Pos) <- 'Correlation'\ncor_Pos$Variable <- row.names(cor_Pos)\ncor_Pos %<>% arrange(desc(abs(Correlation))) \ncor_Pos[-1,]\n\n\ncor(DATA$Posession_H, DATA$Shots_H - DATA$Shots_A)\ncor(DATA$Posession_H, (DATA$Shots_H)/(DATA$Shots_H + DATA$Shots_A))\n\n#5.- Visualization between shots on goals and posession ------------------\n\n\nPos_vs_Shots <- ddply(DATA[,c('Posession_H', 'Shots_H')], \n      .(Posession_H, `Shots_H`), nrow ) \n\nggplot(data=Pos_vs_Shots, aes(x = Posession_H, y = Shots_H )) +\n  geom_point(aes(alpha = V1)) + geom_smooth(color = \"#E69F00\") +\n  labs(x='Posession (%)', y = 'Shots on goal', alpha= 'No. Obs')+\n  ggtitle( 'Home team \\n Posession vs Shots')+\n  theme(plot.title = element_text(hjust = 0.5)) \n    \n#6.- Visualization between Posession and Goal difference ----------------------\n\n\nPos_vs_ShotDif <- ddply(DATA[,c('Posession_H', 'Shots_H', 'Shots_A')], \n                      .(Posession_H, (Shots_H - Shots_A)), nrow ) \n\ncolnames(Pos_vs_ShotDif)[2] <- 'Shot_Dif'\n\nggplot(data=Pos_vs_ShotDif, aes(x = Posession_H, y = Shot_Dif )) +\n  geom_hline(yintercept=0.5, col = 'black', alpha = .05, size = 5)+\n  geom_point(aes(alpha = V1)) + geom_smooth(color = \"#E69F00\") +\n  labs(x='Posession (%)', y = 'Shots on goal \\n difference', alpha= 'No. Obs')+\n  ggtitle( 'Home team \\n Posession vs Shot Difference')+ \n  theme(plot.title = element_text(hjust = 0.5)) \n\n\n#7.- GLM Posession vs Shot difference\n\nDATA$Pos_simp <- DATA$Posession_H - 50\n\nlm(data=DATA, formula = (Shots_H - Shots_A)~ Pos_simp) %>% summary\n\n\n#Analysis by Win tie or lose\nDATA$WTL <- 'Win'\nDATA$WTL[DATA$Result==0] <- 'Tie'\nDATA$WTL[DATA$Result<0] <- 'Lose'\n\nPos_vs_Shots_Res <- ddply(DATA[,c('Posession_H', 'Shots_H','Shots_A', 'WTL')], \n                      .(Posession_H, (Shots_H - Shots_A), WTL), nrow) \n\ncolnames(Pos_vs_Shots_Res)[2] <- 'Shot_Dif'\n\nggplot(data=DATA, aes(x = Posession_H, y = Shots_H - Shots_A )) +\n  geom_point(data = Pos_vs_ShotDif, aes(x = Posession_H, y = Shot_Dif, alpha=V1)) + \n  geom_smooth(aes(group=WTL, , color = WTL)) +\n  labs(x='Posession (%)', y = 'Shots on goal \\n difference', color= 'Result')+\n  ggtitle( 'Home team \\n Posession vs Shot Difference')+ \n  theme(plot.title = element_text(hjust = 0.5)) +\n  scale_fill_manual(values=c( \"#E69F00\", \"#56B4E9\", \"#009E73\"))\n",
    "created" : 1490469432800.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2594599685",
    "id" : "5F48CAB9",
    "lastKnownWriteTime" : 1490490302,
    "last_content_update" : 1490490302574,
    "path" : "C:/Users/fco_n/Documents/fcoStartistician/Possesion_post/Posession_post.R",
    "project_path" : "Possesion_post/Posession_post.R",
    "properties" : {
        "tempName" : "Untitled2"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}